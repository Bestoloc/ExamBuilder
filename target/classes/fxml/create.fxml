<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.*?>
<?import javafx.collections.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.control.cell.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane style="-fx-background-color: #0f172a; -fx-focus-color: transparent; -fx-faint-focus-color: transparent;"
            xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.examsystem.controllers.CreateTicketController" stylesheets="@/style.css">

    <top>
        <VBox spacing="0">
            <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
            <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: #1e293b; -fx-padding: 20 30;">
                <Button onAction="#handleBack" style="-fx-background-color: transparent; -fx-text-fill: #94a3b8;                               -fx-font-weight: bold; -fx-padding: 8 15; -fx-cursor: hand;" text="‚Üê –ù–∞–∑–∞–¥" />

                <Region HBox.hgrow="ALWAYS" />

                <Text fill="#f1f5f9" style="-fx-font-size: 20; -fx-font-weight: bold;">
                    üìù –°–æ–∑–¥–∞–Ω–∏–µ –±–∏–ª–µ—Ç–∞
                </Text>

                <Region HBox.hgrow="ALWAYS" />
            </HBox>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ -->
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-background-color: #3b82f6; -fx-padding: 10 30;">
                <Text fill="white" style="-fx-font-size: 12;">
                    ‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
                </Text>
            </HBox>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" style="-fx-background: transparent; -fx-background-color: transparent; -fx-border-color: transparent;">
            <VBox alignment="TOP_CENTER" spacing="30" style="-fx-padding: 30;">

                <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∏–ª–µ—Ç–∞ -->
                <VBox spacing="25" style="-fx-background-color: #1e293b; -fx-background-radius: 12;                                          -fx-padding: 30; -fx-border-color: #334155;                                          -fx-border-width: 1; -fx-border-radius: 12;">
                    <VBox spacing="10">
                        <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                            üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∏–ª–µ—Ç–∞
                        </Text>
                        <Text fill="#94a3b8" style="-fx-font-size: 13;">
                            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
                        </Text>
                    </VBox>

                    <!-- –§–æ—Ä–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
                    <GridPane hgap="25" style="-fx-padding: 10;" vgap="20">
                        <columnConstraints>
                            <ColumnConstraints prefWidth="200" />
                            <ColumnConstraints prefWidth="350" />
                        </columnConstraints>

                        <!-- –ü—Ä–µ–¥–º–µ—Ç -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14; -fx-font-weight: bold;" text="–ü—Ä–µ–¥–º–µ—Ç" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                        <ComboBox fx:id="subjectComboBox" promptText="–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç" style="-fx-background-color: #0f172a; -fx-background-radius: 8; -fx-border-color: #475569; -fx-border-radius: 8; -fx-border-width: 1; -fx-padding: 12; -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="0" />

                        <!-- –¢–µ–º–∞ -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14; -fx-font-weight: bold;" text="–¢–µ–º–∞" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                        <ComboBox fx:id="topicComboBox" promptText="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                                        -fx-border-color: #475569; -fx-border-radius: 8;                                        -fx-border-width: 1; -fx-padding: 12;                                        -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="1" />

                        <!-- –°–ª–æ–∂–Ω–æ—Å—Ç—å -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14; -fx-font-weight: bold;" text="–°–ª–æ–∂–Ω–æ—Å—Ç—å" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                        <ComboBox fx:id="difficultyComboBox" promptText="–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                                        -fx-border-color: #475569; -fx-border-radius: 8;                                        -fx-border-width: 1; -fx-padding: 12;                                        -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="2">
                            <items>
                                <FXCollections fx:factory="observableArrayList">
                                    <String fx:value="–õ–µ–≥–∫–∏–π" />
                                    <String fx:value="–°—Ä–µ–¥–Ω–∏–π" />
                                    <String fx:value="–°–ª–æ–∂–Ω—ã–π" />
                                </FXCollections>
                            </items>
                        </ComboBox>

                        <!-- –ì—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14; -fx-font-weight: bold;" text="–ì—Ä—É–ø–ø–∞" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                        <ComboBox fx:id="groupComboBox" promptText="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                                        -fx-border-color: #475569; -fx-border-radius: 8;                                        -fx-border-width: 1; -fx-padding: 12;                                        -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="3" />

                        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14; -fx-font-weight: bold;" text="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                        <HBox alignment="CENTER_LEFT" spacing="15" GridPane.columnIndex="1" GridPane.rowIndex="4">
                            <Spinner fx:id="questionCountSpinner" initialValue="3" max="5" min="3" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                                           -fx-border-color: #475569; -fx-border-radius: 8;                                           -fx-border-width: 1;" />
                            <Text style="-fx-font-size: 13; -fx-fill: #94a3b8;">
                                (–æ—Ç 1 –¥–æ 3)
                            </Text>
                        </HBox>
                  <rowConstraints>
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                  </rowConstraints>
                    </GridPane>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <HBox alignment="CENTER" spacing="15" style="-fx-padding: 20 0 0 0;">
                        <Button onAction="#handleShowStudents" style="-fx-background-color: #475569; -fx-text-fill: white;
                        -fx-font-weight: bold; -fx-background-radius: 8;
                        -fx-padding: 12 25; -fx-cursor: hand;" text="üìã –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤">
                        </Button>

                        <Button fx:id="generateButton" onAction="#handleGenerateTicket" style="-fx-background-color: #10b981; -fx-text-fill: white;                                       -fx-font-weight: bold; -fx-background-radius: 8;                                       -fx-padding: 12 30; -fx-cursor: hand;" text="üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç">
                        </Button>
                    </HBox>
                </VBox>

                <!-- –°—Ç—É–¥–µ–Ω—Ç—ã (—Å–∫—Ä—ã—Ç—ã–π —Ä–∞–∑–¥–µ–ª) -->
                <VBox fx:id="studentsSection" spacing="20" visible="false">
                    <VBox style="-fx-background-color: #1e293b; -fx-background-radius: 12;
                    -fx-padding: 25; -fx-border-color: #334155;
                    -fx-border-width: 1; -fx-border-radius: 12;">
                        <VBox spacing="10">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                                    üë• –°—Ç—É–¥–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã
                                </Text>
                                <Text fill="#94a3b8" style="-fx-font-size: 13;">
                                    –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
                                </Text>
                            </HBox>

                            <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                            <TableView fx:id="studentsTable" style="-fx-background-color: #1e293b;
                            -fx-text-fill: #e2e8f0;
                            -fx-border-color: #475569;
                            -fx-border-radius: 8; -fx-border-width: 1;">
                                <columns>
                                    <TableColumn prefWidth="50" text=" ">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="selected" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn prefWidth="250" text="–§–ò–û">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="fullName" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn prefWidth="100" text="–ì—Ä—É–ø–ø–∞">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="groupName" />
                                        </cellValueFactory>
                                    </TableColumn>
                                    <TableColumn prefWidth="120" text="–ö–æ–¥">
                                        <cellValueFactory>
                                            <PropertyValueFactory property="studentCode" />
                                        </cellValueFactory>
                                    </TableColumn>
                                </columns>
                            </TableView>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã -->
                <VBox spacing="20">
                    <VBox style="-fx-background-color: #1e293b; -fx-background-radius: 12;                                -fx-padding: 25; -fx-border-color: #334155;                                -fx-border-width: 1; -fx-border-radius: 12;">
                        <HBox alignment="CENTER_LEFT" spacing="15">
                            <VBox spacing="5">
                                <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                                    üìÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã
                                </Text>
                                <Text fill="#94a3b8" style="-fx-font-size: 13;">
                                    –û—Ü–µ–Ω–∏—Ç–µ –æ—Ç–≤–µ—Ç—ã –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                                </Text>
                            </VBox>

                            <Region HBox.hgrow="ALWAYS" />

                            <Button onAction="#handleSaveScores" style="-fx-background-color: #f59e0b; -fx-text-fill: white;                                           -fx-font-weight: bold; -fx-background-radius: 8;                                           -fx-padding: 12 25; -fx-cursor: hand;" text="üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫–∏">
                            </Button>
                        </HBox>

                        <!-- –¢–∞–±–ª–∏—Ü–∞ –±–∏–ª–µ—Ç–æ–≤ -->
                        <TableView fx:id="ticketsTable" style="-fx-background-color: #1e293b;
                        -fx-text-fill: #e2e8f0;
                        -fx-border-color: #475569;
                        -fx-border-radius: 8; -fx-border-width: 1;">
                            <columns>
                                <TableColumn prefWidth="50" text="‚Ññ">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="ticketNumber" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="180" text="–°—Ç—É–¥–µ–Ω—Ç">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="studentName" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="300" text="–í–æ–ø—Ä–æ—Å">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="questionText" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="130" text="–¢–µ–º–∞">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="topic" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="90" text="–°–ª–æ–∂–Ω–æ—Å—Ç—å">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="difficulty" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="70" text="–û—Ü–µ–Ω–∫–∞">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="score" />
                                    </cellValueFactory>
                                </TableColumn>
                                <TableColumn prefWidth="200" text="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
                                    <cellValueFactory>
                                        <PropertyValueFactory property="comment" />
                                    </cellValueFactory>
                                </TableColumn>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>
