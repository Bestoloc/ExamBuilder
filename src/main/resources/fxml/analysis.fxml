<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.control.cell.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane style="-fx-background-color: #0f172a;" stylesheets="@/style.css" xmlns="http://javafx.com/javafx/17.0.12" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.examsystem.controllers.AnalysisController">

    <top>
        <VBox spacing="0">
            <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
            <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: #1e293b; -fx-padding: 20 30;">
                <Button onAction="#handleBack" style="-fx-background-color: transparent; -fx-text-fill: #94a3b8;                               -fx-font-weight: bold; -fx-padding: 8 15; -fx-cursor: hand;" text="‚Üê –ù–∞–∑–∞–¥" />

                <Region HBox.hgrow="ALWAYS" />

                <VBox alignment="CENTER" spacing="2">
                    <Text fill="#f1f5f9" style="-fx-font-size: 20; -fx-font-weight: bold;">
                        üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    </Text>
                    <Text fill="#94a3b8" style="-fx-font-size: 12;">
                        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                    </Text>
                </VBox>

                <Region HBox.hgrow="ALWAYS" />
            </HBox>

            <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-background-color: #fef3c7; -fx-padding: 12 30;">
                <Text fill="#92400e" style="-fx-font-size: 12;">
                    ‚ö†Ô∏è –í–æ–ø—Ä–æ—Å—ã —Å –Ω–∏–∑–∫–∏–º —Å—Ä–µ–¥–Ω–∏–º –±–∞–ª–ª–æ–º —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞
                </Text>
            </HBox>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" style="-fx-background: transparent; -fx-background-color: transparent; -fx-border-color: transparent;">
            <VBox alignment="TOP_CENTER" spacing="30" style="-fx-padding: 30;">

                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <VBox style="-fx-background-color: #1e293b; -fx-background-radius: 12;                            -fx-padding: 25; -fx-border-color: #334155;                            -fx-border-width: 1; -fx-border-radius: 12;">
                    <VBox spacing="10">
                        <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                            üîç –§–∏–ª—å—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞
                        </Text>
                        <Text fill="#94a3b8" style="-fx-font-size: 13;">
                            –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                        </Text>
                    </VBox>

                    <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
                    <GridPane hgap="20" style="-fx-padding: 15 0;" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints prefWidth="150" />
                            <ColumnConstraints prefWidth="250" />
                            <ColumnConstraints prefWidth="170.0" />
                        </columnConstraints>

                        <!-- –°—Ç—É–¥–µ–Ω—Ç -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14;" text="–°—Ç—É–¥–µ–Ω—Ç" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                        <ComboBox fx:id="studentComboBox" promptText="–í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                         -fx-border-color: #475569; -fx-border-radius: 8;                         -fx-border-width: 1; -fx-padding: 10;                         -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="0">
                        </ComboBox>
                        <Button onAction="#handleShowStudentStats" prefHeight="37.0" prefWidth="174.0" style="-fx-background-color: #475569; -fx-text-fill: white;                         -fx-font-weight: bold; -fx-background-radius: 8;                         -fx-padding: 10 15; -fx-cursor: hand;" text="–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É" GridPane.columnIndex="2" GridPane.rowIndex="0">
                        </Button>

                        <!-- –ü—Ä–µ–¥–º–µ—Ç -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14;" text="–ü—Ä–µ–¥–º–µ—Ç" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                        <ComboBox fx:id="subjectComboBox" promptText="–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                         -fx-border-color: #475569; -fx-border-radius: 8;                                        -fx-border-width: 1; -fx-padding: 10;                         -fx-text-fill: #f1f5f9; -fx-prompt-text-fill: #64748b;" GridPane.columnIndex="1" GridPane.rowIndex="1">
                        </ComboBox>
                        <Button onAction="#handleShowGeneralStats" style="-fx-background-color: #10b981; -fx-text-fill: white;                         -fx-font-weight: bold; -fx-background-radius: 8;                         -fx-padding: 10 15; -fx-cursor: hand;" text="–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" GridPane.columnIndex="2" GridPane.rowIndex="1">
                        </Button>

                        <!-- –ü–µ—Ä–∏–æ–¥ -->
                        <Label style="-fx-text-fill: #e2e8f0; -fx-font-size: 14;" text="–ü–µ—Ä–∏–æ–¥" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                        <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="2">
                            <DatePicker fx:id="startDatePicker" promptText="–ù–∞—á–∞–ª–æ" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                             -fx-border-color: #475569; -fx-border-radius: 8;                                              -fx-border-width: 1;" />
                            <DatePicker fx:id="endDatePicker" promptText="–ö–æ–Ω–µ—Ü" style="-fx-background-color: #0f172a; -fx-background-radius: 8;                             -fx-border-color: #475569; -fx-border-radius: 8;                                              -fx-border-width: 1;" />
                        </HBox>
                        <Button onAction="#handleResetFilters" style="-fx-background-color: #64748b; -fx-text-fill: white;                         -fx-font-weight: bold; -fx-background-radius: 8;                                       -fx-padding: 10 15; -fx-cursor: hand;" text="–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã" GridPane.columnIndex="2" GridPane.rowIndex="2">
                        </Button>
                  <rowConstraints>
                     <RowConstraints />
                     <RowConstraints />
                     <RowConstraints />
                  </rowConstraints>
                    </GridPane>
                </VBox>

                <!-- –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <VBox style="-fx-background-color: #1e293b; -fx-background-radius: 12;                            -fx-padding: 25; -fx-border-color: #334155;                            -fx-border-width: 1; -fx-border-radius: 12;">
                    <VBox spacing="10">
                        <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                            üìà –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </Text>
                        <Text fill="#94a3b8" style="-fx-font-size: 13;">
                            –û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
                        </Text>
                    </VBox>

                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                    <HBox alignment="CENTER" spacing="20" style="-fx-padding: 20 0;">
                        <!-- –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª -->
                        <VBox alignment="CENTER" spacing="8" style="-fx-background-color: #0f172a; -fx-background-radius: 10;                                    -fx-padding: 20; -fx-border-color: #334155;                                    -fx-border-width: 1; -fx-border-radius: 10;">
                                <Label fx:id="avgScoreLabel" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-fill: #3b82f6;" text="0.0" textFill="#3b82f6" />
                            <Text style="-fx-font-size: 14; -fx-fill: #94a3b8;">
                                –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
                            </Text>
                        </VBox>

                        <!-- –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
                        <VBox alignment="CENTER" spacing="8" style="-fx-background-color: #0f172a; -fx-background-radius: 10;                                    -fx-padding: 20; -fx-border-color: #334155;                                    -fx-border-width: 1; -fx-border-radius: 10;">
                                <Label fx:id="totalQuestionsLabel" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-fill: #10b981;" text="0" textFill="#10b981" />
                            <Text style="-fx-font-size: 14; -fx-fill: #94a3b8;">
                                –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤
                            </Text>
                        </VBox>

                        <!-- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                        <VBox alignment="CENTER" spacing="8" style="-fx-background-color: #0f172a; -fx-background-radius: 10;                                    -fx-padding: 20; -fx-border-color: #334155;                                    -fx-border-width: 1; -fx-border-radius: 10;">
                                <Label fx:id="uniqueStudentsLabel" style="-fx-font-size: 32; -fx-font-weight: bold; -fx-fill: #f59e0b;" text="0" textFill="#f59e0b" />
                            <Text style="-fx-font-size: 14; -fx-fill: #94a3b8;">
                                –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                            </Text>
                        </VBox>
                    </HBox>
                </VBox>

                <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <VBox spacing="15">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <VBox spacing="2">
                            <Text fill="#f1f5f9" style="-fx-font-size: 18; -fx-font-weight: bold;">
                                üìã –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                            </Text>
                            <Text fill="#94a3b8" style="-fx-font-size: 13;">
                                –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É
                            </Text>
                        </VBox>

                        <Region HBox.hgrow="ALWAYS" />
                    </HBox>

                    <!-- –¢–∞–±–ª–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ -->
                    <TableView fx:id="analysisTable" style="-fx-background-color: #1e293b; -fx-background-radius: 8;                                      -fx-border-color: #475569; -fx-border-radius: 8;                                      -fx-border-width: 1;">
                        <columns>
                            <TableColumn prefWidth="50" text="‚Ññ">
                                <cellValueFactory>
                                    <PropertyValueFactory property="questionId" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="300" text="–í–æ–ø—Ä–æ—Å">
                                <cellValueFactory>
                                    <PropertyValueFactory property="questionText" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="150" text="–¢–µ–º–∞">
                                <cellValueFactory>
                                    <PropertyValueFactory property="topic" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="–°–ª–æ–∂–Ω–æ—Å—Ç—å">
                                <cellValueFactory>
                                    <PropertyValueFactory property="difficulty" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="100" text="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω">
                                <cellValueFactory>
                                    <PropertyValueFactory property="usageCount" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="80" text="–°—Ä. –±–∞–ª–ª">
                                <cellValueFactory>
                                    <PropertyValueFactory property="avgScore" />
                                </cellValueFactory>
                            </TableColumn>
                            <TableColumn prefWidth="120" text="–°—Ç–∞—Ç—É—Å">
                                <cellValueFactory>
                                    <PropertyValueFactory property="status" />
                                </cellValueFactory>
                            </TableColumn>
                        </columns>
                    </TableView>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>
